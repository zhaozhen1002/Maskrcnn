# Mask R-CNN for train your own dataset
## Introduction
This is an Step-by-step tutorial of Mask R-CNN - How to train your own dataset on Python 3, Keras, and TensorFlow.Using [Mask R-CNN](https://arxiv.org/abs/1703.06870) based on https://github.com/matterport/Mask_RCNN.   [「for 日本語」](README_JP.md)

The test demo is done at the following environment  

CUDA9.1

tensorflow1.12

keras2.1.6 

TeslaV100X2」

## Steps
### Prepare
<details>
    <summary>View Detail</summary>
    
* usage of utils：[Labelme](https://github.com/wkentaro/labelme)  
 
Use label to mark the destination object of each pictures
The labels of the destination objects should be following at the folling rules

``` 
ClassName_ObjectNumber  
```

For Example

```

cat_1

cat_2

dog_1

```


* Prepare train_data

  create a folder named train_data.The hierarchy in train_data can be referred from [here](train_data)
  
  <img width="420" height="157" src=figure/1.PNG/>  
  
  1.pic(training pictures)
  
  <div align=center><img width="600" height="380" src=figure/pic.PNG/></div>
  
  2.json(generated by labelme,labelme is the name of a tool)
  
  <div align=center><img width="600" height="310" src=figure/json.PNG/></div>  
  
  3.labelme_json(generated by labelme_json_to_dataset,labelme_json_to_dataset is a command script in labelme)
  [how to use labelme_json_to_dataset](https://github.com/wkentaro/labelme/issues/420)
  
  landscape of the folders
  <div align=center><img width="600" height="310" src=figure/labelme_json.PNG/></div>  
  
  the content of the folder
  <div align=center><img width="600" height="150" src=figure/detail.PNG/></div> 
    
  4.cv_to_mask(copy the label.png from every folder in labelme_json,and rename it with the original number)
  <div align=center><img width="600" height="310" src=figure/cv2_mask.PNG/></div>  
  
</details>


### Train the network
* [train.py](samples/shapes/train.py)  

```bash
python train.py --CLASS_NAME ['car_damage','car_crack'] --epoch 100 ......
```

Other configurations can be adjusted at /mrcnn/config.py

### Test the network

* [test.py](samples/shapes/test.py)

 ```bash
 python test.py --class_names ['car_damage', 'car_crack'] ......
 ```  
The Consequence of the test will be saved at /test_data/

example:if the value of threshsold is set at 0.5,Only the pictures which's threshsold is gt 0.5 will be saved at /test_data/

### Visualization on tensorboard

 ```bash
tensorboard --logdir 自分のpath/MaskRCNN-Damage-Detection/logs/shapes20190930T1107 --host 0.0.0.0
http://localhost:6006/
 ```
 <div align=center><img width="800" height="350" src=figure/loss.PNG/></div>
